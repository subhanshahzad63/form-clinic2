<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">

	<title>Document</title>
	<style>
		body {
			font-family: Arial, sans-serif;
			margin: 0;
			padding: 0;
			background-color: #f4f4f4;
			display: flex;
			justify-content: center;
			align-items: center;
			min-height: 100vh;
		}

		.container {
			width: 700px;
			padding: 20px;
			/* Reduce padding */
			background-color: white;
			box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
			text-align: center;
			margin-top: 0;
			/* Remove any extra margins */
		}

		.title {
			font-weight: bold;
			font-size: 16px;
			text-transform: uppercase;
			margin-bottom: 20px;
			/* Adjust bottom margin */
		}

		.address {
			text-align: left;
			font-size: 14px;
			margin-bottom: 20px;
		}

		.section-title {
			text-align: left;
			font-size: 14px;
			font-weight: bold;
			margin-top: 20px;
			margin-bottom: 10px;
		}

		table {
			width: 100%;
			border-collapse: collapse;
			margin-bottom: 20px;
			border: 1px solid black;
		}

		@media print {

			/* Show the hidden image in PDF */
			.hidden-pdf-image {
				display: block !important;
			}

			/* Hide buttons in the PDF */
			button {
				display: none !important;
			}

			#clearBtn {
				display: none !important;
			}
		}

		/* Hide the image by default in the browser */
		.hidden-pdf-image {
			display: none;
		}


		td {
			padding: 5px;
			text-align: left;
			font-size: 14px;
			border-bottom: 1px solid black;
		}

		tr:last-child td {
			border-bottom: none;
		}

		input[type="text"],
		input[type="number"] {
			border: none;
			font-size: 14px;
			outline: none;
			display: inline-block;
			width: 100%;
		}

		.rm-input {
			width: auto;
			display: inline-block;
			margin-left: 5px;
			/* Add a small margin to space it from "RM" */
		}

		td .rm-input {
			display: inline;
			width: 80px;
			/* Adjust width if needed */
		}


		.section-b table {
			width: 100%;
			border-collapse: collapse;
			margin-bottom: 20px;
			border: 1px solid black;
		}

		.section-b th,
		.section-b td {
			padding: 5px;
			text-align: left;
			font-size: 14px;
			border: 1px solid black;
		}

		.section-b .right-align {
			text-align: right;
		}

		.final-section {
			text-align: left;
			font-size: 14px;
			margin-top: 20px;
		}

		.final-section ol {
			margin-left: 20px;
		}

		.signature-section {
			margin-top: 30px;
			text-align: left;
		}

		.final-section ol {
			margin-left: 0;
			padding-left: 20px;
		}

		.final-section input[type="text"] {
			width: 150px;
			border-bottom: 1px solid black;
			display: inline-block;
		}

		hr {
			border: 0.5px solid black;
			margin: 20px 0;
		}

		img {
			width: 100%;
			max-width: 700px;
		}

		/* Adjustments for smaller signature canvas */
		canvas {
			border: 1px solid black;
			display: inline-block;
			vertical-align: middle;
		}

		.signature-container {
			display: inline-block;
		}

		button {
			margin-top: 10px;
			padding: 5px;
			background-color: #008CBA;
			color: white;
			border: none;
			cursor: pointer;
		}

		button:disabled {
			background-color: grey;
		}

		#loader {
			position: fixed;
			left: 0;
			top: 0;
			width: 100%;
			height: 100%;
			z-index: 9999;
			background-color: rgba(255, 255, 255, 0.8);
			display: flex;
			justify-content: center;
			align-items: center;
		}

		.spinner {
			border: 16px solid #f3f3f3;
			border-top: 16px solid #3498db;
			border-radius: 50%;
			width: 120px;
			height: 120px;
			animation: spin 2s linear infinite;
		}

		@keyframes spin {
			0% {
				transform: rotate(0deg);
			}

			100% {
				transform: rotate(360deg);
			}
		}
	</style>
</head>

<body>
	<div class="container">
		<div class="title">
			Pengesahan Pendapatan dan Tidak Mendapat Pembiayaan / Perlindungan Yang Serupa
		</div>
		<div class="address">
			Kepada,<br>
			Pengarah<br>
			Jabatan Kebajikan Masyarakat Sarawak
		</div>

		<div class="section-title">
			Bahagian A: Maklumat Pemohon
		</div>
		<table>
			<tr>
				<td class="col-label">Nama Pemohon</td>
				<td class="col-separator">:</td>
				<td class="col-value"><input type="text" placeholder="Enter name"></td>
			</tr>
			<tr>
				<td class="col-label">No. Kad Pengenalan</td>
				<td class="col-separator">:</td>
				<td class="col-value"><input type="text" placeholder="Enter ID number"></td>
			</tr>
			<tr>
				<td class="col-label">No. Telefon</td>
				<td class="col-separator">:</td>
				<td class="col-value"><input type="text" placeholder="Enter phone number"></td>
			</tr>
			<tr>
				<td class="col-label">Pekerjaan</td>
				<td class="col-separator">:</td>
				<td class="col-value"><input type="text" placeholder="Enter occupation"></td>
			</tr>
			<tr>
				<td class="col-label">Pendapatan Sebulan</td>
				<td class="col-separator">:</td>
				<td class="col-value">RM <input type="number" class="rm-input" placeholder="Amount"></td>
			</tr>
		</table>

		<div class="section-title">
			Bahagian B: Pendapatan Ahli isi Rumah Yang Tinggal Bersama
		</div>
		<div class="section-b">
			<table>
				<thead>
					<tr>
						<th>Bil</th>
						<th>Ahli Keluarga Yang Tinggal Bersama</th>
						<th>Pekerjaan</th>
						<th>Pendapatan (RM)</th>
					</tr>
				</thead>
				<tbody>
					<tr>
						<td>1.</td>
						<td><input type="text" class="family-name"></td>
						<td><input type="text" class="family-occupation"></td>
						<td><input type="text" class="family-income"></td>
					</tr>
					<tr>
						<td>2.</td>
						<td><input type="text" class="family-name"></td>
						<td><input type="text" class="family-occupation"></td>
						<td><input type="text" class="family-income"></td>
					</tr>
					<tr>
						<td>3.</td>
						<td><input type="text" class="family-name"></td>
						<td><input type="text" class="family-occupation"></td>
						<td><input type="text" class="family-income"></td>
					</tr>
					<tr>
						<td>4.</td>
						<td><input type="text" class="family-name"></td>
						<td><input type="text" class="family-occupation"></td>
						<td><input type="text" class="family-income"></td>
					</tr>
					<tr>
						<td>5.</td>
						<td><input type="text" class="family-name"></td>
						<td><input type="text" class="family-occupation"></td>
						<td><input type="text" class="family-income"></td>
					</tr>
					<tr>
						<td>6.</td>
						<td><input type="text" class="family-name"></td>
						<td><input type="text" class="family-occupation"></td>
						<td><input type="text" class="family-income"></td>
					</tr>
					<tr>
						<td colspan="3" class="right-align">Jumlah</td>
						<td>RM <input type="text" class="rm-input"></td>
					</tr>

				</tbody>
			</table>
		</div>

		<div class="final-section">
			<p>Dengan ini saya mengaku bahawa semua maklumat yang dinyatakan adalah benar. Sekiranya maklumat yang
				diberikan adalah tidak benar maka permohonan ini akan terbatal.</p>
			<ol>
				<li>Pendapatan saya dan Isi Rumah yang tinggal bersama berjumlah RM
					<input type="text" class="final-income" style="border-bottom: 1px solid black;">
				</li>
				<li>Mengesahkan bahawa saya tidak mendapat pembiayaan/perlindungan yang serupa dari mana-mana agensi.
				</li>
			</ol>
		</div>

		<div class="signature-section">
			<label for="signatureCanvas">Tandatangan atau Cop Jari :</label>
			<div class="signature-container" id="signatureContainer">
				<canvas id="signatureCanvas" width="150" height="50"></canvas>
				<button id="clearBtn">Clear</button>
			</div>
		</div>



		<div class="signature-section">
			<p>Tarikh: <input type="text" class="signature-date" style="border-bottom: 1px solid black; width: 150px;"
					disabled></p>

		</div>

		<hr style="border: 0.5px solid black; margin-bottom: 20px;">
		<div class="section-title">
			PENGESAHAN OLEH KETUA KAUM / KETUA MASYARAKAT / PEGAWAI KUMPULAN A
		</div>
		<p style="text-align: left;">Dengan ini saya mengesahkan bahawa sepanjang pengetahuan saya, maklumat yang
			diberikan oleh pemohon adalah benar.</p>
		<div style="text-align: left;">
			<img class="hidden-pdf-image" src="/assets/1.png" alt="Signature and Stamp"
				style="width: 100%; max-width: 800px; height: 120px;">
		</div>
		<div id="loader" style="display: none;">
			<div class="spinner"></div>
		</div>


		<button id="downloadBtn">Submit</button>



	</div>

	<script>
		// Signature Canvas
		const canvas = document.getElementById('signatureCanvas');
		const ctx = canvas.getContext('2d');
		let drawing = false;

		// Mouse Events
		canvas.addEventListener('mousedown', startDrawing);
		canvas.addEventListener('mousemove', draw);
		canvas.addEventListener('mouseup', stopDrawing);
		canvas.addEventListener('mouseleave', stopDrawing);

		// Touch Events for mobile/touch devices
		canvas.addEventListener('touchstart', startTouchDrawing, { passive: false });
		canvas.addEventListener('touchmove', drawTouch, { passive: false });
		canvas.addEventListener('touchend', stopDrawing);

		// Prevent default touch action (scrolling) while drawing
		function startTouchDrawing(e) {
			e.preventDefault(); // Prevent scrolling
			const touch = e.touches[0];
			const mouseEvent = new MouseEvent('mousedown', {
				clientX: touch.clientX,
				clientY: touch.clientY
			});
			canvas.dispatchEvent(mouseEvent);
		}

		function drawTouch(e) {
			e.preventDefault(); // Prevent scrolling
			const touch = e.touches[0];
			const mouseEvent = new MouseEvent('mousemove', {
				clientX: touch.clientX,
				clientY: touch.clientY
			});
			canvas.dispatchEvent(mouseEvent);
		}

		// Start drawing (for both mouse and touch)
		function startDrawing(e) {
			drawing = true;
			draw(e); // Draw the initial point
		}

		// Drawing function for mouse events
		function draw(e) {
			if (!drawing) return;
			ctx.lineWidth = 2;
			ctx.lineCap = 'round';
			ctx.strokeStyle = 'black';

			const rect = canvas.getBoundingClientRect();
			const x = e.clientX - rect.left;
			const y = e.clientY - rect.top;

			ctx.lineTo(x, y);
			ctx.stroke();
			ctx.beginPath();
			ctx.moveTo(x, y);
		}

		// Stop drawing
		function stopDrawing() {
			drawing = false;
			ctx.beginPath(); // Reset the path
		}

		// Clear the signature canvas
		document.getElementById('clearBtn').addEventListener('click', function () {
			ctx.clearRect(0, 0, canvas.width, canvas.height);
		});

		// Auto-generate the current date for "Tarikh"
		document.addEventListener('DOMContentLoaded', function () {
			const dateField = document.querySelector('.signature-date');
			const currentDate = new Date().toLocaleDateString('en-GB'); // Format as DD/MM/YYYY
			dateField.value = currentDate;
		});

		// Submit form and clear all fields after submission
		document.getElementById('downloadBtn').addEventListener('click', function () {
			// Show the loader
			document.getElementById('loader').style.display = 'flex';

			const canvas = document.getElementById('signatureCanvas');
			const signatureDataUrl = canvas.toDataURL(); // Capture the signature as an image

			// Collect form data
			const formData = {
				applicantName: document.querySelector('input[placeholder="Enter name"]').value,
				idNumber: document.querySelector('input[placeholder="Enter ID number"]').value,
				phoneNumber: document.querySelector('input[placeholder="Enter phone number"]').value,
				occupation: document.querySelector('input[placeholder="Enter occupation"]').value,
				income: document.querySelector('input[placeholder="Amount"]').value,
				familyMembers: Array.from(document.querySelectorAll('.family-name')).map((el, index) => ({
					name: el.value,
					occupation: document.querySelectorAll('.family-occupation')[index].value,
					income: document.querySelectorAll('.family-income')[index].value,
				})),
				finalIncome: document.querySelector('.final-income').value,
				signatureDate: document.querySelector('.signature-date').value,
				signature: signatureDataUrl // Include the signature image
			};

			// Send the form data to the server
			fetch('/download-pdf', {
				method: 'POST',
				headers: {
					'Content-Type': 'application/json'
				},
				body: JSON.stringify(formData)
			})
				.then(response => response.json())
				.then(data => {
					alert('PDF generated and emailed successfully!');
					document.getElementById('loader').style.display = 'none'; // Hide the loader

					// Clear form fields after successful submission
					document.querySelectorAll('input').forEach(input => input.value = '');
					ctx.clearRect(0, 0, canvas.width, canvas.height); // Clear the signature
					// Reset date field to the current date
					const dateField = document.querySelector('.signature-date');
					const currentDate = new Date().toLocaleDateString('en-GB'); // Format as DD/MM/YYYY
					dateField.value = currentDate;
				})
				.catch(error => {
					console.error('Error:', error);
					document.getElementById('loader').style.display = 'none'; // Hide the loader in case of error
				});
		});
	</script>



</body>

</html>